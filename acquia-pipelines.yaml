version: 1.2.0

cde-databases:
  - db1
  - db2
  
variables:
  global:
    CDE_DEPLOY_POLL_TIMEOUT: 10000000
    SYNC_DB_POLL_TIMEOUT: 100000

events:
  build:
    steps:
      # If you have build instructions, put them here. They are not required.
      - build_site:
          script:
            - touch docroot/index.html
            - echo "Test!"
            - echo "You successfully deployed your build to an ODE SYNC PR!." > docroot/index.html

  post-deploy:
    steps:
      # Deploy the build artifact to a Cloud on-demand environment.
      - deploy:
          script:
            - date +"%T"
            - pipelines-sync-dbs db1 || echo 'INVALID USAGE?'
            - pipelines-deploy
            - pipelines-sync-dbs db1 db2
            - date +"%T"

  # When a GitHub pull request is merged, this deletes the coresponding ODE.
  pr-merged:
    steps:
      - deploy:
          script:
            - echo "Pull request merged"
            - pipelines-deploy

  # When a GitHub pull request is closed, this deletes the coresponding ODE.
  pr-closed:
    steps:
      - deploy:
          script:
            - echo "Pull request closed"
            - pipelines-deploy
